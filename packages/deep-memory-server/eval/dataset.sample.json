{
  "version": 1,
  "cases": [
    {
      "name": "filters expired ephemeral memory and resolves conflict by memory_key",
      "namespace": "teamA",
      "now": "2026-02-01T00:00:00.000Z",
      "query": {
        "userInput": "What's my timezone preference?",
        "sessionId": "sess-1",
        "entities": ["timezone"],
        "topics": ["preferences"],
        "maxMemories": 3
      },
      "qdrantHits": [
        {
          "id": "teamA::mem_tz_old",
          "score": 0.91,
          "payload": {
            "content": "User prefers timezone: UTC.",
            "importance": 0.8,
            "frequency": 2,
            "created_at": "2025-12-01T00:00:00.000Z",
            "updated_at": "2026-01-15T00:00:00.000Z",
            "kind": "preference",
            "memory_key": "preference:timezone",
            "subject": "timezone"
          }
        },
        {
          "id": "teamA::mem_tz_new",
          "score": 0.88,
          "payload": {
            "content": "User prefers timezone: Asia/Shanghai.",
            "importance": 0.9,
            "frequency": 1,
            "created_at": "2026-01-20T00:00:00.000Z",
            "updated_at": "2026-01-25T00:00:00.000Z",
            "kind": "preference",
            "memory_key": "preference:timezone",
            "subject": "timezone"
          }
        },
        {
          "id": "teamA::mem_ephemeral",
          "score": 0.95,
          "payload": {
            "content": "Temporary code: 123456 (expires soon).",
            "importance": 0.7,
            "frequency": 1,
            "created_at": "2026-01-31T00:00:00.000Z",
            "kind": "ephemeral",
            "expires_at": "2026-01-31T12:00:00.000Z"
          }
        }
      ],
      "neo4jHits": [
        {
          "id": "teamA::mem_tz_new",
          "content": "User prefers timezone: Asia/Shanghai.",
          "importance": 0.9,
          "frequency": 1,
          "lastSeenAt": "2026-01-25T00:00:00.000Z",
          "relationScore": 0.9,
          "kind": "preference",
          "memoryKey": "preference:timezone",
          "subject": "timezone"
        }
      ],
      "expect": {
        "includeIds": ["teamA::mem_tz_new"],
        "excludeIds": ["teamA::mem_ephemeral"],
        "top1Id": "teamA::mem_tz_new",
        "uniqueByMemoryKey": true
      }
    }
  ]
}
